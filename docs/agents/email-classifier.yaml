id: email-classifier
name: Email Classifier
description: Classifies incoming emails, creates tasks, routes to analyst or responder
version: "2026-02-24"
department: email

reports_to: main
creates_tasks_for: [email-analyst, email-responder]
receives_tasks_from: []
escalates_to: main

model:
  primary: openrouter/moonshotai/kimi-k2.5
  fallbacks:
    - openrouter/anthropic/claude-sonnet-4.6
    - gemini/gemini-2.5-pro
  payload_alias: kimi

schedule:
  cron: "0 6-22/2 * * *"
  timezone: America/New_York
  timeout_seconds: 600
  max_iterations: 10
  session_target: isolated

delivery:
  mode: none

tools_allowed:
  - exec
  - read_file
  - write_file
  - search_memory
  - get_entity
  - store_memory
  - list_conversations
  - log_interaction
  - create_person
  - create_task
  - list_tasks
  - list_my_tasks
  - resolve_task
  - update_task
  - append_to_block
tools_denied:
  - message
bridge_endpoints:
  - "GET /health"
  - "GET /api/conversations"
  - "POST /log-interaction"
  - "POST /api/people"
  - "POST /api/tasks"
  - "GET /api/tasks"
  - "PATCH /api/tasks/*"
  - "GET /api/tasks/agent/*"
  - "POST /api/tasks/*/resolve"
  - "POST /api/memory/blocks/*/append"
streams:
  read: [email]
  write: []

sla:
  urgent: 30m
  high: 2h
  normal: 8h
  low: 24h

task_protocol: true
review_workflow: false
notification_inbox: false
status_file: brain/memory/email-classifier-status.md
shared_working_state: true

warmup:
  context_files:
    - brain/memory/email-classifier-status.md

instruction_file: brain/EMAIL_CLASSIFIER.md
bootstrap_files:
  - brain/AGENTS.md
  - brain/TOOLS.md

hooks:
  - stream: email
    event_type: email.new
    message: "New email received. Process the triage inbox and classify emails."
  - stream: email
    event_type: triage.refreshed
    message: "Triage inbox refreshed with new items. Process the triage inbox and classify emails."

downstream_agents:
  - email-analyst
  - email-responder

tags_produced: [email, reply-needed, analytical, escalation, needs-philip]
tags_consumed: []

v2:
  error_feedback: true

changelog:
  - date: "2026-03-01"
    change: "Add triage.refreshed hook — classifier now fires on triage prep (not just email.new). Cron is 2h safety net."
  - date: "2026-02-28"
    change: "CRITICAL FIX: Add exec, read_file, write_file, search_memory, get_entity, store_memory — agent was blind without file access. Delivery→none."
  - date: "2026-02-27"
    change: Relax cron to 6h safety-net (primary trigger is now hook on email.new)
  - date: "2026-02-24"
    change: Add list_tasks for dedup check; fix analytical routing to email-analyst
  - date: "2026-02-24"
    change: Initial manifest creation from existing config
  - date: "2026-02-23"
    change: Per-agent ID created, separated from generic 'email' agent
